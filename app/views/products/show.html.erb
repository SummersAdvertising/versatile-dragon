<article>
  <section>
    <div id="banner_series">
      <div class="bread"><a href="/<%= I18n.locale %>">首頁</a> > <a href="#">優質系列</a></div>
    </div>
    <div id="main">
      <div id="side">
        <% @productclasses.each do |productclass| %>
        <div class="category">
          <h5><%= link_to productclass.name, productclass_path(productclass, :locale => I18n.locale) %></h5>
          <ul>
            <% if(productclass.id.to_s == params[:productclass_id] && productclass.products.size > 0) %>
            <% productclass.products.each do |product| %>
            <% if(product.status == "enable") %>
            <% if(product.id.to_s == params[:id]) %>
            <li class="active">
            <% else %>
            <li>
            <% end %>
            <%= link_to product.name, productclass_product_path(@productclass, product, :locale => I18n.locale) %></li>
            <% end %>
            
            <% end %>
            
            <% end %>
          </ul>
        </div>
        <% end %>
      </div>

      <div id="content">
        <div class="bread">
          <%= link_to @productclass.name, productclass_path(@productclass, :locale => I18n.locale) %> >
          <a href="#"><%= @product.name %></a></div> 
        <input id="product_content" style="display:none;" type="text" value="<%=@product.content%>">
        <div id="articleContent" class="main-text"></div>
      </div>
    </div>
  </section>
</article>


<script type="text/javascript">
$(document).ready(function() {
  $("#productclasses").addClass("active");
  showContent();

  function showContent(){
    if($("#product_content").val())
    {
      var obj = JSON.parse($("#product_content").val());
      var article = "";
      for(i=0;i<obj.article.length;i++)
      {
        var paragraph = obj.article[i];

        if(JSON.stringify(paragraph.type)=='"paragraph"')
        {
          article = "<p class='"+paragraph.cssclass+"'>";

          if(paragraph.link){
            article += "<a target='_blank' href='"+paragraph.link+"'>"+jsonReplace(JSON.stringify(paragraph.content)).replace(/\\n/g, "<br />")+"</a></p>";
          }
          else{
            article += jsonReplace(JSON.stringify(paragraph.content)).replace(/\\n/g, "<br />")+"</p></div>";
          }
        }
        else if(JSON.stringify(paragraph.type)=='"image"')
        {
          article = "<p><img alt=" + JSON.stringify(paragraph.id) + " src=" + JSON.stringify(paragraph.path) + " title=" + JSON.stringify(paragraph.id) + " /></p>";
        }
        else if(JSON.stringify(paragraph.type)=='"linkedimg"')
        {
          article = "<p><a href="+JSON.stringify(paragraph.link)+" target='_blank'><img alt=" + JSON.stringify(paragraph.imgid) + " src=" + JSON.stringify(paragraph.imgpath) + " title=" + JSON.stringify(paragraph.imgid) + " /></a></p>";
        }
        else if (JSON.stringify(paragraph.type)=='"video"') {
          article = "<p><iframe width=\"480\" height=\"290\" data-code=\"" + paragraph.code + "\" src=\"http://www.youtube.com/embed/" + paragraph.code+ "\" frameborder=\"0\" allowfullscreen></iframe></p>";
        }
        $("#articleContent").append(article);
      }
    }
  }

  function jsonReplace(string){return string.replace(/"([^"]*)"/g, "$1");}
  
});

</script>
