<article>
  <section class="hgroup">
    <h2><%= show_product_bread(@product).html_safe %></h2>
  </section>
  <!--hgroup-->
  <section class="category">
    <ul>
      <li><a href="../edit">產品圖</a></li>
      <li><a href="../edit/intro">產品描述</a></li>
      <li><a href="../edit/point">產品特色</a></li>
      <li class="active"><a href="javascript:void(0)">產品規格</a></li>
      <li><a href="../edit/wrap">出貨包裝</a></li>
      <li><a href="../edit/size">尺寸表</a></li>
      <li><a href="../edit/wash">洗滌方式</a></li>
      <li><a href="../edit/outro">其他</a></li>
    </ul>
  </section>
  <!--category-->

  <section class="text text-edit">
    <%= form_for(@photo, :url => "../uploadPhoto", :remote => true) do |f| %>
    <%= f.hidden_field :img_type, :value => "form" %>
      
    <div class="half">
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
          <th>圖片</th>
          <td>
            <%= f.file_field :image, :class => "validate[required, checkFileType[jpg|jpeg|gif|JPG|png|PNG]]" %>
          </td>
        </tr>
        <tr>
          <td><%= f.submit("新增",:style => "width:50px;font-size:12px;margin:15px 0 0 5px;padding:6px") %></td>
        </tr>
      </table>
    </div>
    <% end %>
  </section>

  <section class="text text-edit" id="photos_form">
    <p id="no_photo_form" style="display: <%= @photos_form.empty? ? "block" : "none" %>;">尚未上傳圖片</p>

    <% @photos_form.each do |photo| %>
    <div class="three" id="photo_form_<%= photo.id %>">
      <%= image_tag("/uploads/Productphoto/#{@product.id}/#{photo.id}-#{photo.name}") %><br>
      <%= link_to("刪除", "../deletePhoto/#{photo.id}", :method => :delete, :remote => true) %>
    </div>
    <% end %>
  </section>

  <%= form_for(@product, :url => admin_productclass_subclass_product_path(params[:productclass_id], params[:subclass_id], @product, :locale => I18n.locale), :method => "put") do |f| %>

  <%= hidden_field_tag(:next_step, "edit_wrap") %>
  <section class="post">
      <div id="post-li">
        <table width="100%" border="0" cellspacing="0" cellpadding="0">
          <% @forms && @forms["items"].each_with_index do |item, index| %>
          <tr>
            <th width="7%">項目：</th>
            <td width="20%"><input name="content_form[]items[]" type="text" value="<%= item %>"></td>
            <th width="7%">內容：</th>
            <td width="59%"><input name="content_form[]contents[]" type="text" value="<%= @forms['contents'][index] %>"></td>
            <td width="7%" align="center"><a href="javascript:void(0)" class="remove_form"><img src="/images/delete.png"></a></td>
          </tr>
          <% end %>

          <% unless(@forms) %>
          <tr>
            <th width="7%">項目：</th>
            <td width="20%"><input name="content_form[]items[]" type="text"></td>
            <th width="7%">內容：</th>
            <td width="59%"><input name="content_form[]contents[]" type="text"></td>
            <td width="7%" align="center"><a href="javascript:void(0)" class="remove_form"><img src="/images/delete.png"></a></td>
          </tr>
          <% end %>
        </table>
        <ul class="tool-a">
          <li class="add_form"><a href="javascript:void(0)">新增</a></li>
        </ul>
      </div>      
    </section>
    <!--post-->
  <% end #form %>

  

  <section class="button" id="btnSubmit">
    <a href="javascript:$('#edit_product_<%= @product.id %>').submit();">
      <img src="/images/next.png">
      下一步</a>
    <a href="../edit/point"><img src="/images/back.png">上一步</a>
  </section>
  <!--button-->
</article>

<script type="text/javascript">
$(document).ready(function(){
  $("#nav-2").parent().addClass("active");
  
  $("#lang a").unbind().click(function(event){
    event.preventDefault();
    Alertify.log.error("文章編輯中, 無法切換語系");
  });

  $(".remove_form").click(function(){
    remove_form(this);
  });

  $(".add_form").click(function(){
    var tr = $("<tr>");
    var th = $("<th>");
    var td = $("<td>");
    var input = $('<input type="text">');
    var a = $('<a href="javascript:void(0)" class="remove_form"><img src="/images/delete.png">');
    
    a.click(function(){
      remove_form(this);
    });

    tr.append( th.clone().attr("width", "7%").append("項目：") )
      .append( th.clone().attr("width", "20%").append( input.clone().attr("name", "content_form[]items[]") ) )
      .append( th.clone().attr("width", "7%").append("內容：") )
      .append( th.clone().attr("width", "59%").append( input.clone().attr("name", "content_form[]contents[]") ) )
      .append( th.clone().attr("width", "7%").attr("align", "center").append(a) );


    $("#post-li table").append(tr);
  });

  function remove_form(trigger){
    if($(".remove_form").length > 1){
      $(trigger).parents("tr:first").remove();
    }
    else{
      alert("請至少保留一筆產品規格");
    }
  }
});
</script>